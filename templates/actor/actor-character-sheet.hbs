<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">

  {{!-- En-tête de la fiche --}}
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100" />
    <div class="header-fields">
      <div class="charname-container">
        <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'Name'}}" /></h1>
        
        {{!-- Voies du personnage --}}
        <div class="character-voies">
          {{#if allVoies.length}}
            {{#each allVoies as |voie|}}
              <span class="voie-badge" data-voie-id="{{voie._id}}">
                {{voie.name}}
                {{#if voie.system.grade}}
                  ({{voie.system.grade}})
                {{/if}}
              </span>
            {{/each}}
          {{else}}
            <span class="voie-label">{{localize "MYRIAD_SYSTEM.NoVoie"}}</span>
          {{/if}}
        </div>
      </div>

      <div class="resources-container">
        {{!-- Points de Vie --}}
        <div class="resource flex-group-center health-resource">
          <label class="resource-label">{{localize "MYRIAD_SYSTEM.Usage.costTypes.health"}}</label>
          <div class="resource-content flexrow flex-center flex-between">
            <input type="text" name="system.health.value" value="{{#if calculatedHealth}}{{calculatedHealth.value}}{{else}}{{system.health.value}}{{/if}}" data-dtype="Number" />
            <span class="sep">/</span>
            <input type="text" name="system.health.max" value="{{#if calculatedHealth}}{{calculatedHealth.max}}{{else}}{{system.health.max}}{{/if}}" data-dtype="Number" />
          </div>
        </div>
        
        {{!-- Points d'XP --}}
        <div class="resource flex-group-center xp-resource">
          <label class="resource-label">{{localize "MYRIAD_SYSTEM.XP.label"}}</label>
          <div class="resource-content flexrow flex-center flex-between">
            <span class="xp-unspent">{{#if calculatedXP}}{{calculatedXP.unspent}}{{else}}{{system.xp.unspent}}{{/if}}</span>
            <span class="sep">/</span>
            <span class="xp-total">{{#if calculatedXP}}{{calculatedXP.earned}}{{else}}{{system.xp.earned}}{{/if}}</span>
          </div>
        </div>

        {{!-- Points de Magie (conditional) --}}
        {{#if hasMagic}}
        <div class="resource flex-group-center magic-resource">
          <label class="resource-label">{{localize "MYRIAD_SYSTEM.Usage.costTypes.magic"}}</label>
          <div class="resource-content flexrow flex-center flex-between">
            <input type="text" name="system.magic.points.value" value="{{system.magic.points.value}}"
              data-dtype="Number" />
            <span class="sep">/</span>
            <input type="text" name="system.magic.points.max" value="{{system.magic.points.max}}" data-dtype="Number" />
          </div>
        </div>
        {{/if}}
      </div>
    </div>
  </header>

  {{!-- Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="characteristics">{{localize "MYRIAD_SYSTEM.SheetLabels.Characteristics"}}</a>
    <a class="item" data-tab="features">{{localize "MYRIAD_SYSTEM.SheetLabels.Competences"}}</a>
    <a class="item" data-tab="magic">{{localize "MYRIAD_SYSTEM.SheetLabels.Magic"}}</a>
    <a class="item" data-tab="inventory">{{localize "MYRIAD_SYSTEM.SheetLabels.Inventory"}}</a>
    <a class="item" data-tab="biography">{{localize "Biography"}}</a>
  </nav>

  {{!-- Contenu des onglets --}}
  <section class="sheet-body">
    {{!-- Caractéristiques --}}
    <div class="tab characteristics" data-group="primary" data-tab="characteristics">
      <div class="characteristics-container">
        {{!-- Caractéristiques Physiques --}}
        <div class="characteristics-column physical">
          <h3 class="column-header">Caractéristiques Physiques</h3>
          <div class="characteristic flex-group-center">
            <label class="characteristic-label">{{localize config.characteristics.puissance}}</label>
            <div class="characteristic-content">
              <input type="text" name="system.characteristics.puissance.value"
                value="{{system.characteristics.puissance.value}}" data-dtype="Number" />
              <div class="characteristic-modifiers">
                {{#if system.characteristics.puissance.bonus}}
                <span class="characteristic-bonus">+{{system.characteristics.puissance.bonus}}</span>
                {{/if}}
                {{#if system.characteristics.puissance.malus}}
                <span class="characteristic-malus">-{{system.characteristics.puissance.malus}}</span>
                {{/if}}
              </div>
            </div>
          </div>
          <div class="characteristic flex-group-center">
            <label class="characteristic-label">{{localize config.characteristics.coordination}}</label>
            <div class="characteristic-content">
              <input type="text" name="system.characteristics.coordination.value"
                value="{{system.characteristics.coordination.value}}" data-dtype="Number" />
              <div class="characteristic-modifiers">
                {{#if system.characteristics.coordination.bonus}}
                <span class="characteristic-bonus">+{{system.characteristics.coordination.bonus}}</span>
                {{/if}}
                {{#if system.characteristics.coordination.malus}}
                <span class="characteristic-malus">-{{system.characteristics.coordination.malus}}</span>
                {{/if}}
              </div>
            </div>
          </div>
        </div>

        {{!-- Séparateur --}}
        <div class="characteristics-separator"></div>

        {{!-- Caractéristiques Mentales --}}
        <div class="characteristics-column mental">
          <h3 class="column-header">Caractéristiques Mentales</h3>
          <div class="characteristic flex-group-center">
            <label class="characteristic-label">{{localize config.characteristics.ingeniosite}}</label>
            <div class="characteristic-content">
              <input type="text" name="system.characteristics.ingeniosite.value"
                value="{{system.characteristics.ingeniosite.value}}" data-dtype="Number" />
              <div class="characteristic-modifiers">
                {{#if system.characteristics.ingeniosite.bonus}}
                <span class="characteristic-bonus">+{{system.characteristics.ingeniosite.bonus}}</span>
                {{/if}}
                {{#if system.characteristics.ingeniosite.malus}}
                <span class="characteristic-malus">-{{system.characteristics.ingeniosite.malus}}</span>
                {{/if}}
              </div>
            </div>
          </div>
          <div class="characteristic flex-group-center">
            <label class="characteristic-label">{{localize config.characteristics.perspicacite}}</label>
            <div class="characteristic-content">
              <input type="text" name="system.characteristics.perspicacite.value"
                value="{{system.characteristics.perspicacite.value}}" data-dtype="Number" />
              <div class="characteristic-modifiers">
                {{#if system.characteristics.perspicacite.bonus}}
                <span class="characteristic-bonus">+{{system.characteristics.perspicacite.bonus}}</span>
                {{/if}}
                {{#if system.characteristics.perspicacite.malus}}
                <span class="characteristic-malus">-{{system.characteristics.perspicacite.malus}}</span>
                {{/if}}
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    {{!-- Compétences Tab --}}
    <div class="tab features" data-group="primary" data-tab="features">
      {{!-- Voies --}}
      <div class="voies">
        <header class="items-header flexrow">
          <h3 class="item-name">{{localize "MYRIAD_SYSTEM.ItemType.voie"}}</h3>
          <div class="item-controls">
            <a class="item-control item-create" title="Create Voie" data-type="voie"><i class="fas fa-plus"></i></a>
          </div>
        </header>
        <ol class="items-list">
          {{#each voies as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <div class="item-name">
              <div class="item-image">
                <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
              </div>
              <h4>{{item.name}}</h4>
            </div>
            <div class="item-grade">
              {{localize "MYRIAD_SYSTEM.Grade.label"}}: 
              {{#if item.system.grade}}
                <span class="grade-value">
                {{#if (eq (toNumber item.system.grade) 1)}}
                  {{localize "MYRIAD_SYSTEM.Grade.I"}}
                {{else if (eq (toNumber item.system.grade) 2)}}
                  {{localize "MYRIAD_SYSTEM.Grade.II"}}
                {{else if (eq (toNumber item.system.grade) 3)}}
                  {{localize "MYRIAD_SYSTEM.Grade.III"}}
                {{else if (eq (toNumber item.system.grade) 4)}}
                  {{localize "MYRIAD_SYSTEM.Grade.IV"}}
                {{else if (eq (toNumber item.system.grade) 5)}}
                  {{localize "MYRIAD_SYSTEM.Grade.V"}}
                {{else}}
                  {{localize "MYRIAD_SYSTEM.Grade.I"}}
                {{/if}}
                </span>
              {{else}}
                <span class="grade-value">{{localize "MYRIAD_SYSTEM.Grade.I"}}</span>
              {{/if}}
            </div>
            <div class="item-controls">
              <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ol>
      </div>
      
      {{!-- Liste des Compétences --}}
      <div class="competences">
        <header class="items-header flexrow">
          <h3 class="item-name">{{localize "MYRIAD_SYSTEM.ItemType.competence"}}</h3>
          <div class="item-controls">
            <a class="item-control item-create" title="Create Competence" data-type="competence"><i
                class="fas fa-plus"></i></a>
          </div>
        </header>
        <ol class="items-list">
          {{#each competences as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <div class="item-name">
              <div class="item-image">
                <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
              </div>
              <h4>{{item.name}}</h4>
            </div>
            <div class="item-grade">
              {{#if item.system.isUnique}}
                {{localize "MYRIAD_SYSTEM.Competence.Unique"}}
              {{else}}
                {{localize "MYRIAD_SYSTEM.Grade.label"}}: 
                {{#if item.system.grade}}
                  <span class="grade-value">
                  {{#if (eq (toNumber item.system.grade) 1)}}
                    {{localize "MYRIAD_SYSTEM.Grade.I"}}
                  {{else if (eq (toNumber item.system.grade) 2)}}
                    {{localize "MYRIAD_SYSTEM.Grade.II"}}
                  {{else if (eq (toNumber item.system.grade) 3)}}
                    {{localize "MYRIAD_SYSTEM.Grade.III"}}
                  {{else if (eq (toNumber item.system.grade) 4)}}
                    {{localize "MYRIAD_SYSTEM.Grade.IV"}}
                  {{else if (eq (toNumber item.system.grade) 5)}}
                    {{localize "MYRIAD_SYSTEM.Grade.V"}}
                  {{else}}
                    {{localize "MYRIAD_SYSTEM.Grade.I"}}
                  {{/if}}
                  </span>
                {{else}}
                  <span class="grade-value">{{localize "MYRIAD_SYSTEM.Grade.I"}}</span>
                {{/if}}
              {{/if}}
            </div>
            <div class="item-controls">
              <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ol>
      </div>

      {{!-- Autres Capacités --}}
      <div class="features">
        <header class="items-header flexrow">
          <h3 class="item-name">{{localize "MYRIAD_SYSTEM.ItemType.feature"}}</h3>
          <div class="item-controls">
            <a class="item-control item-create" title="Create Feature" data-type="feature"><i
                class="fas fa-plus"></i></a>
          </div>
        </header>
        <ol class="items-list">
          {{#each features as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            {{> "systems/myriad-system/templates/actor/parts/actor-features.hbs"}}
          </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{!-- Magie --}}
    <div class="tab magic" data-group="primary" data-tab="magic">
      {{!-- Arts --}}
      <div class="arts">
        <header class="items-header flexrow">
          <h3 class="item-name">{{localize "MYRIAD_SYSTEM.ItemType.art"}}</h3>
          <div class="item-controls">
            <a class="item-control item-create" title="Create Art" data-type="art"><i class="fas fa-plus"></i></a>
          </div>
        </header>
        <ol class="items-list">
          {{#each arts as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            {{> "systems/myriad-system/templates/actor/parts/actor-features.hbs"}}
          </li>
          {{/each}}
        </ol>
      </div>

      {{!-- Domaines --}}
      <div class="domains">
        <header class="items-header flexrow">
          <h3 class="item-name">{{localize "MYRIAD_SYSTEM.ItemType.domain"}}</h3>
          <div class="item-controls">
            <a class="item-control item-create" title="Create Domain" data-type="domain"><i class="fas fa-plus"></i></a>
          </div>
        </header>
        <ol class="items-list">
          {{#each domains as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            {{> "systems/myriad-system/templates/actor/parts/actor-features.hbs"}}
          </li>
          {{/each}}
        </ol>
      </div>

      {{!-- Sorts --}}
      {{> "systems/myriad-system/templates/actor/parts/actor-spells.hbs"}}
    </div>

    {{!-- Inventaire --}}
    <div class="tab inventory" data-group="primary" data-tab="inventory">
      <div class="inventory-grid">
        {{#each system.inventory.grid as |row y|}}
        <div class="inventory-row">
          {{#each row as |cell x|}}
          <div class="inventory-cell" data-x="{{x}}" data-y="{{y}}" {{#if cell.item}}data-item-id="{{cell.item}}"
            {{/if}}>
            {{#if cell.item}}
            <img src="{{cell.img}}" title="{{cell.name}}" />
            {{/if}}
          </div>
          {{/each}}
        </div>
        {{/each}}
      </div>
      {{!-- Liste d'objets en vrac --}}
      <div class="overflow-items">
        <h3>{{localize "Overflow Items"}}</h3>
        <ol class="items-list">
          {{#each overflowItems as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            {{> "systems/myriad-system/templates/actor/parts/actor-items.hbs"}}
          </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{!-- Biographie --}}
    <div class="tab biography" data-group="primary" data-tab="biography">
      {{editor enrichedBiography target="system.biography" button=true owner=owner editable=editable}}
    </div>
  </section>
</form>